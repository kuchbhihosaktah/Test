import requests
from telegram import Update
from telegram.ext import Updater, CommandHandler, CallbackContext

# ---------------- CONFIGURATION ----------------
TOKEN = "YOUR_TELEGRAM_BOT_API_TOKEN"  # Telegram bot token yahan daalo
NGROK_URL = "https://7384db352347.ngrok-free.app"  # Colab ka ngrok URL

# ---------------- FUNCTIONS ----------------
def start(update: Update, context: CallbackContext):
    update.message.reply_text(
        "Hello! Send me a prompt using /video command.\nExample: /video A flying anime cat"
    )

def generate_video(update: Update, context: CallbackContext):
    if len(context.args) == 0:
        update.message.reply_text("Please provide a prompt, e.g., /video A flying anime cat")
        return

    prompt = " ".join(context.args)
    update.message.reply_text(f"Generating video for: {prompt} ‚è≥")

    try:
        # Send POST request to Colab Flask server
        response = requests.post(f"{NGROK_URL}/generate", json={"prompt": prompt}, stream=True)

        if response.status_code == 200:
            # Save video temporarily
            video_path = "/tmp/video.mp4"
            with open(video_path, "wb") as f:
                for chunk in response.iter_content(chunk_size=1024*1024):
                    if chunk:
                        f.write(chunk)
            # Send video to Telegram
            update.message.reply_video(video=open(video_path, "rb"))
        else:
            update.message.reply_text(f"Server error: {response.status_code}")

    except Exception as e:
        update.message.reply_text(f"Failed to generate video: {e}")

# ---------------- BOT SETUP ----------------
updater = Updater(TOKEN)
dp = updater.dispatcher

dp.add_handler(CommandHandler("start", start))
dp.add_handler(CommandHandler("video", generate_video, pass_args=True))

print("ü§ñ Bot is running...")
updater.start_polling()
updater.idle()
